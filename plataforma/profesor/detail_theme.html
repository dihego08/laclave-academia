<!-- 
=========================================================
 Light Bootstrap Dashboard - v2.0.1
=========================================================

 Product Page: https://www.creative-tim.com/product/light-bootstrap-dashboard
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/light-bootstrap-dashboard/blob/master/LICENSE)

 Coded by Creative Tim

=========================================================

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  -->
<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link href="../../img/logo.ico" rel="shortcut icon" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title id="title_theme">Nabavet - Plataforma Virtual</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../assets/css/demo.css" rel="stylesheet" />
    <link href="../assets/css/stylo.css" rel="stylesheet" />
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <div class="sidebar-wrapper">
                <div class="logo">
                    <span class="simple-text" id="user_name">

                    </span>
                </div>
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>Inicio</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./user.html">
                            <i class="nc-icon nc-circle-09"></i>
                            <p>Mi Perfil</p>
                        </a>
                    </li>
                    <!--<li class=" active">
                        <a class="nav-link" href="./modulos.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>Modulos</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./asistencias.html">
                            <i class="nc-icon nc-paper-2"></i>
                            <p>Asistencias</p>
                        </a>
                    </li>-->
                    <!--<li>
                        <a class="nav-link" href="./typography.html">
                            <i class="nc-icon nc-paper-2"></i>
                            <p>Typography</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./icons.html">
                            <i class="nc-icon nc-atom"></i>
                            <p>Icons</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./maps.html">
                            <i class="nc-icon nc-pin-3"></i>
                            <p>Maps</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./notifications.html">
                            <i class="nc-icon nc-bell-55"></i>
                            <p>Notifications</p>
                        </a>
                    </li>
                    <li class="nav-item active active-pro">
                        <a class="nav-link active" href="upgrade.html">
                            <i class="nc-icon nc-alien-33"></i>
                            <p>Upgrade to PRO</p>
                        </a>
                    </li>-->
                </ul>
                <div class="logo"><img class="w-100" src="../../img/logo.png" alt=""
                        style="border-radius: 4px; box-shadow: 0px 2px 2px #313131;" /></div>
                <!--<div class="logo"><img class="w-100" src="assets/img/g2804.png" alt="" /></div>
                <div class="logo"><img class="w-100" src="assets/img/g3775.png" alt="" /></div>
                <div class="logo"><img class="w-100" src="assets/img/g3853.png" alt="" /></div>-->
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">
                    <span class="navbar-brand"> Detalle del Curso </span>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                        aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <h3 class="w-100 text-center my-3" id="theme_name"></h3>
                    <h5 class="w-100 text-center mb-0">Recursos y Tareas del Curso</h5>
                    <h5 id="theme_horario" class="w-100 text-center"></h5>
                    <div class="row">
                        <div class="col-md-12">
                            <progress id="progressBar" class="mt-0" value="0" max="100" style="width:100%;"></progress>
                            <p id="status"></p>
                            <p id="loaded_n_total"></p>
                        </div>
                        <div class="col-md-6">
                            <h4 class="w-100 text-center">Recursos Adicionales</h4>
                            <div class="form-row py-2 px-2" style="box-shadow: 0px 2px 2px 0px #313131;">
                                <div class="col-md-12 mb-2">
                                    <label>Archivo</label>
                                    <input type="file" class="form-control" id="archivo" name="archivo">
                                </div>
                                <div class="col-md-12 mb-2">
                                    <label>Enlace</label>
                                    <input type="text" class="form-control" id="enlace" name="enlace">
                                </div>
                                <div class="col-md-12 mt-2">
                                    <button class="btn btn-success w-100" id="btn_accion"
                                        onclick="guardar_recurso();">Guardar</button>
                                </div>
                            </div>
                            <div id="div_recursos_adicionales" class="mt-3 card p-2">

                            </div>
                        </div>
                        <div class="col-md-6">
                            <h4 class="w-100 text-center">Tareas</h4>
                            <div class="form-row py-2 px-2" style="box-shadow: 0px 2px 2px 0px #313131;">
                                <div class="col-md-6 mb-2">
                                    <label>Identificador</label>
                                    <input type="text" class="form-control" id="tarea" name="tarea">
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label>Fecha de Entrega</label>
                                    <input type="text" class="form-control datepicker" id="fecha_entrega"
                                        name="fecha_entrega">
                                </div>
                                <div class="col-md-12 mb-2">
                                    <label>Archivo</label>
                                    <input type="file" class="form-control" id="archivo_tarea" name="archivo_tarea">
                                </div>
                                <div class="col-md-12 mt-2">
                                    <button class="btn btn-success w-100" id="btn_accion"
                                        onclick="guardar_tarea();">Guardar</button>
                                </div>
                            </div>
                            <div id="div_tareas" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <p class="copyright text-center">
                            ©
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                            <a href="http://softluttion.com">Softluttion</a>, made with love for a better web
                        </p>
                    </nav>
                </div>
            </footer>
        </div>
    </div>
    <!----------------------------------------------------------------------->
    <div class="modal fade" id="formulario" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document" style="max-width: 95%;">
            <div class="modal-content" style="background-color: #f1f1f1; height: auto;">
                <div class="modal-header" style="position: relative; padding-top: 0; padding-bottom: 0;">
                    <h3 class="modal-title mb-4" id="curso_nombre"
                        style="border-bottom: solid #f3e444; color: #313131;">Entregas de la Tarea</h3>
                </div>
                <div class="modal-body">
                    <div class="form-row mb-3" style="width: 100%;" id="form_row_">
                        <table class="table table-hover table-bordered" id="tabla_entregas">
                            <thead>
                                <th>Alumno</th>
                                <th>Tarea</th>
                                <th>Fecha</th>
                                <th>Observacion</th>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <span class="btn btn-danger pull-right" type="button" data-dismiss="modal"
                        id="cerrar_formulario_grado" style="margin-left: 10px">
                        Cerrar
                    </span>
                </div>
            </div>
        </div>
    </div>
    <!----------------------------------------------------------------------->
</body>
<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="../assets/js/plugins/bootstrap-switch.js"></script>
<!--  Chartist Plugin  -->
<script src="../assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="../assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"
    integrity="sha512-8vfyGnaOX2EeMypNMptU+MwwK206Jk1I/tMQV4NkhOz+W8glENoMhGyU6n/6VgQUhQcJH8NqQgHhMtZjJJBv3A=="
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.4/jquery.datetimepicker.full.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.4/build/jquery.datetimepicker.min.css"
    rel="stylesheet" />
<script>
    function _(el) {
        return document.getElementById(el);
    }

    function uploadFile() {
        var file = _("file1").files[0];
        var formdata = new FormData();
        formdata.append("file1", file);
        formdata.append("id_tema", $("#id_tema").val());
        formdata.append("id_tema", $("#id_tema").val());
        formdata.append("tarea", $("#tarea").val());
        formdata.append("fecha_entrega", $("#fecha_entrega").val());
        formdata.append("parAccion", "guardar_nota");
        var ajax = new XMLHttpRequest();
        ajax.upload.addEventListener("progress", progressHandler, false);
        ajax.addEventListener("load", completeHandler, false);
        ajax.addEventListener("error", errorHandler, false);
        ajax.addEventListener("abort", abortHandler, false);
        ajax.open("POST", "../php/tarea.php");
        ajax.send(formdata);
    }

    function progressHandler(event) {
        _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
        var percent = (event.loaded / event.total) * 100;
        _("progressBar").value = Math.round(percent);
    }

    function completeHandler(event) {
        var res = JSON.parse(event.target.response);
        if (res.Result == "OK") {
            bootbox.alert({
                message: '<div class="alert alert-success" style="margin-top: 5%; margin-bottom: 0;">' +
                    '<strong>Realizado Correctamente.</strong>' +
                    '</div>'
            });
            theme_detail(id_tema_);
            limpiar_formulario();
        } else {
            bootbox.alert({
                message: '<div class="alert alert-danger" style="margin-top: 5%; margin-bottom: 0;">' +
                    '<strong>Algo ha salido mal.</strong>' +
                    '</div>'
            });
        }
        _("progressBar").value = 0;
    }

    function errorHandler(event) {
        _("status").innerHTML = "Upload Failed";
    }

    function abortHandler(event) {
        _("status").innerHTML = "Upload Aborted";
    }
</script>
<script type="text/javascript">
    var id_tema_ = 0;
    $(document).ready(function () {
        $(".datepicker").datetimepicker({
            format: "Y-m-d",
            timepicker: false
        });
        $.datetimepicker.setLocale('es');
        limpiar_formulario();
        localStorage.setItem('cur_url', window.location.href);

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        get_data();
        theme_detail(getUrlParameter('tm'));
    });
    function get_data() {
        $.post('../logic/servicios.php?parAccion=get_data', function (data) {
            var obj = JSON.parse(data);

            $("#user_name").text(obj.user_name);
        });
    }
    var dias = ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado'];
    function theme_detail(id) {
        id_tema_ = id;
        $.post('../logic/servicios.php?parAccion=theme_detail', {
            id: id
        }, function (data) {
            var obj = JSON.parse(data);

            $("#theme_name").text(obj.tema);
            $("#title_theme").text(obj.tema);

            $("#theme_horario").empty();
            $("#div_recursos_adicionales").empty();
            $("#div_tareas").empty();

            $.each(obj.horarios, function (index, val) {
                //$("#theme_horario").append(`<small class="my-1" style="color: #313131;">${val.fecha}: <i class="nc-icon nc-time-alarm icon-horario"></i> ${val.hora_inicio} - ${val.hora_fin}</small> `);
            });

            $.each(obj.recursos, function (i, v) {
                $("#div_recursos_adicionales").append(`
                    <p style="position: relative;">
                        ${parseInt(i + 1)}. <a href="${v.enlace}" target="_blank">${v.nombre}</a>
                        <span title="Eliminar Recurso" onclick="eliminar_recurso(${v.id});" style="border-radius: 50%; color: #dc3545; cursor: pointer; position: absolute; top: 5px; right: 5px;"><i class="fa fa-trash"></i></span>
                    </p>
                    <hr class="w-100 my-0">
                `);
            });
            $.each(obj.tareas, function (i, v) {
                $("#div_tareas").append(`
                    <div class="w-100">
                        <div class="card mb-1">
                            <div class="card-header">
                                <p class="mb-0">${v.tarea}</p>
                                <small><a href="/tareas/${v.archivo}" target="_blank">${v.archivo}</a></small>
                                <span title="Eliminar Tarea" onclick="eliminar_tarea(${v.id});" style="border-radius: 50%; color: #dc3545; cursor: pointer; position: absolute; top: 5px; right: 5px;"><i class="fa fa-trash"></i></span>
                            </div>
                            <hr class="w-100 my-0">
                            <div class="card-body">
                                <small data-toggle="modal" data-target="#formulario" class="badge badge-primary" style="cursor: pointer;" onclick="ver_entregas(${v.id});">Ver Entregas</small>
                                <div class="w-100 text-right">
                                    <small class="badge badge-danger">Fecha Entrega: ${v.fecha_entrega}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
            });
        });
    }
    function eliminar_recurso(id_recurso) {
        bootbox.confirm({
            message: "¿Está seguro de eliminar este recurso?",
            buttons: {
                confirm: {
                    label: 'Sí',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    $.post("../logic/servicios.php?parAccion=eliminar_recurso", {
                        id: id_recurso
                    }, function (response) {
                        var obj = JSON.parse(response);

                        if (obj.Result == "OK") {
                            theme_detail(id_tema_);
                            bootbox.alert({
                                message: '<div class="alert alert-success" style="margin-top: 5%; margin-bottom: 0;">' +
                                    '<strong>Realizado Correctamente.</strong>' +
                                    '</div>'
                            });
                        } else {
                            bootbox.alert({
                                message: '<div class="alert alert-danger" style="margin-top: 5%; margin-bottom: 0;">' +
                                    '<strong>Algo ha salido mal.</strong>' +
                                    '</div>'
                            });
                        }
                    });
                } else {

                }
            }
        });
    }
    function eliminar_tarea(id_tarea) {
        bootbox.confirm({
            message: "¿Está seguro de eliminar esta tarea?",
            buttons: {
                confirm: {
                    label: 'Sí',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    $.post("../logic/servicios.php?parAccion=eliminar_tarea", {
                        id: id_tarea
                    }, function (response) {
                        var obj = JSON.parse(response);

                        if (obj.Result == "OK") {
                            theme_detail(id_tema_);
                            bootbox.alert({
                                message: '<div class="alert alert-success" style="margin-top: 5%; margin-bottom: 0;">' +
                                    '<strong>Realizado Correctamente.</strong>' +
                                    '</div>'
                            });
                        } else {
                            bootbox.alert({
                                message: '<div class="alert alert-danger" style="margin-top: 5%; margin-bottom: 0;">' +
                                    '<strong>Algo ha salido mal.</strong>' +
                                    '</div>'
                            });
                        }
                    });
                } else {

                }
            }
        });
    }
    function ver_entregas(id_tarea) {
        $.post('../logic/servicios.php?parAccion=ver_entregas_tareas', {
            id_tarea: id_tarea
        }, function (response) {
            var obj = JSON.parse(response);
            $("#tabla_entregas").find("tbody").empty();
            $.each(obj, function (index, val) {
                $("#tabla_entregas").find("tbody").append(`
                        <tr>
                            <td>
                                ${val.alumno}
                            </td>
                            <td style="font-size: 12px;"><a href="/entrega-tareas/${val.archivo}" target="_blank">${val.archivo}</a></td>
                            <td>${val.fecha}</td>
                            <td>${val.observacion}</td>
                        </tr>
                    `);
            });
        });
    }
    function guardar_recurso() {
        var file = _("archivo").files[0];
        var formdata = new FormData();
        formdata.append("archivo", file);

        formdata.append("id_curso", id_tema_);

        formdata.append("enlace", $("#enlace").val());
        var ajax = new XMLHttpRequest();
        ajax.upload.addEventListener("progress", progressHandler, false);
        ajax.addEventListener("load", completeHandler, false);
        ajax.addEventListener("error", errorHandler, false);
        ajax.addEventListener("abort", abortHandler, false);
        ajax.open("POST", "../logic/servicios.php?parAccion=guardar_recurso");
        ajax.send(formdata);
    }
    function guardar_tarea() {
        var file = _("archivo_tarea").files[0];
        var formdata = new FormData();
        formdata.append("archivo", file);

        formdata.append("id_curso", id_tema_);

        formdata.append("fecha_entrega", $("#fecha_entrega").val());
        formdata.append("tarea", $("#tarea").val());
        var ajax = new XMLHttpRequest();
        ajax.upload.addEventListener("progress", progressHandler, false);
        ajax.addEventListener("load", completeHandler, false);
        ajax.addEventListener("error", errorHandler, false);
        ajax.addEventListener("abort", abortHandler, false);
        ajax.open("POST", "../logic/servicios.php?parAccion=guardar_tarea");
        ajax.send(formdata);
    }
    function limpiar_formulario() {
        $("#fecha_entrega").val("");
        $("#tarea").val("");
        $("#enlace").val("");
        $("#archivo_tarea").val("");
        $("#archivo").val("");
    }
</script>

</html>