<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link href="../img/logo.ico" rel="shortcut icon" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Transmision en Vivo - La Clave Academia :: Plataforma Virtual</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="assets/css/demo.css" rel="stylesheet" />
    <link href="assets/css/stylo.css" rel="stylesheet" />
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="assets/img/sidebar-5.jpg">
            <div class="sidebar-wrapper">
                <div class="logo">
                    <h4 class="simple-text mt-0 mb-1" id="user_name">
                        
                    </h4>
                    <span class="w-100 text-center" style="display: block;" id="career_name"></span>
                    <small class="w-100 text-center" style="display: block; text-transform: uppercase; opacity: 0.5;" id="area_name"></small>
                </div>
                <ul class="nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>Inicio</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./user.html">
                            <i class="nc-icon nc-circle-09"></i>
                            <p>Mi Perfil</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./cursos.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>Mis Cursos</p>
                        </a>
                    </li>
                    <!--<li>
                        <a class="nav-link" href="./asistencias.html">
                            <i class="nc-icon nc-paper-2"></i>
                            <p>Asistencias</p>
                        </a>
                    </li>-->
                    <li>
                        <a class="nav-link" href="./entregas.html">
                            <i class="nc-icon nc-paper-2"></i>
                            <p>Mis Entregas</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./biblioteca.html">
                            <i class="nc-icon nc-bullet-list-67"></i>
                            <p>Biblioteca</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./examen.html">
                            <i class="nc-icon nc-ruler-pencil"></i>
                            <p>Ranking</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./estadisticas">
                            <i class="nc-icon nc-atom"></i>
                            <p>Estadisticas</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./logout.php">
                            <i class="nc-icon nc-spaceship"></i>
                            <p>Cerrar Sesion</p>
                        </a>
                    </li>
                </ul>
                <div class="logo"><img class="w-100" src="../img/logo.png" alt="" style="border-radius: 4px; box-shadow: 0px 2px 2px #313131;" /></div>
                <!--<div class="logo"><img class="w-100" src="assets/img/g2804.png" alt="" /></div>
                <div class="logo"><img class="w-100" src="assets/img/g3775.png" alt="" /></div>
                <div class="logo"><img class="w-100" src="assets/img/g3853.png" alt="" /></div>-->
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">
                    <span class="navbar-brand"> Inicio </span>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <h4 id="titulo_curso" class="ocultar mt-3" style="color: #313131 !important;"></h4>
                        <div class="w-100 text-right pr-3">
                            <button class="btn-sm btn-danger btn" id="btn_marcar_salida">Salir</button>
                        </div>
                        <hr>
                        <div id="meet" class="w-100"></div>
                        <iframe src="" id="transmision_externa" frameborder="0"></iframe>
                        <div id="boton_externo"></div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <p class="copyright text-center">
                            Â©
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                            <a href="https://softluttion.com">Softluttion</a>, made with love for a better web
                        </p>
                    </nav>
                </div>
            </footer>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="assets/js/plugins/bootstrap-switch.js"></script>
<!--  Chartist Plugin  -->
<script src="assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src='https://meet.jit.si/external_api.js'></script>
<script type="text/javascript">
    $(document).ready(function() {
        get_data();

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        get_all(getUrlParameter('tm'));

        $("#btn_marcar_salida").attr('onclick', 'marcar_salida('+getUrlParameter('tm')+');');
    });
    function get_data() {
        $.post('logic/servicios.php?parAccion=get_data', function (data) {
            var obj = JSON.parse(data);

            if (obj.user_name == null || obj.user_name == "" || obj.user_name == undefined) {
                //location.href = "../";
                location.href = "../login/login_a.php";
            } else {
                $("#user_name").text(obj.user_name);
                $("#career_name").text(obj.carrera);
                $("#area_name").text(obj.area);
            }
        });
    }
    const domain = 'meet.jit.si';
        
    function ver_transmision(sala) {
        const options = {
            roomName: sala,
            width: '100%',
            height: 700,
            parentNode: document.querySelector('#meet')
        };
        const api = new JitsiMeetExternalAPI(domain, options);
    }

    function get_all(id_curso) {
        $.post("logic/servicios.php?parAccion=get_info_tema", {
            id_curso: id_curso
        }, function(response) {
            var obj = JSON.parse(response);
            //$("#clase_name").append("Clase: " + obj.video.titulo);
            $("#titulo_curso").html("Curso: " + obj.curso);
            $("#div_transmision").append(`<iframe style="min-height: 640px;" class="w-100 h-100" src="https://www.youtube.com/embed/${obj.transmision}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`);
            $("#div_chat_vivo").append(`<iframe class="w-100 h-100" src="https://www.youtube.com/live_chat?v=${obj.transmision}&amp;embed_domain=softluttion.com"></iframe>`);

            if (obj.sala == "" || obj.sala == null || obj.sala == undefined) {
                //$("#transmision_externa").prop('src', obj.externo);
                var enlace_externo = "";
                if(obj.externo.substring(0,5) == "https"){
                	enlace_externo = obj.externo;
                }else{
                	enlace_externo = `https://${obj.externo}`;
                }
                $("#boton_externo").append(`
                    <a target="_blank" class="btn btn-success" href="${enlace_externo}">Enlace a Meet o Zoom</a>
                `);
            }else{
                ver_transmision(obj.sala);
            }
        });
    }
    function marcar_salida(id_curso) {
        $.post("logic/servicios.php?parAccion=marcar_salida", {
            id_curso: id_curso
        }, function(response) {
            var obj = JSON.parse(response);
            if (obj.Result == "OK") {
                window.location.href = localStorage.getItem("cur_url");
            } else {
                alert("Algo ha salido mal.");
            }
        });
    }
</script>

</html>
